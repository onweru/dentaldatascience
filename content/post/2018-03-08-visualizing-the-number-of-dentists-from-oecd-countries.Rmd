---
title: Visualizing the dentists workforce of OECD countries
author: Sergio Uribe
date: '2018-03-08'
slug: visualizing-the-dentists-workforce-of-oecd-countries
categories:
  - visualization
tags:
  - ggplot2
---

The Organisation for Economic Co-operation and Development host a [database](https://data.oecd.org/) with extensive data. In this post we will some visualizations to compare the number of dentists in each country. 

Packages used: 
  - tidyverse
  - gghighlight
  - kableExtra

```{r, echo=FALSE, results='hide', warning=FALSE, message=FALSE}
library(tidyverse)
```


First we load the data. Now there is a package ([OECD](https://cran.r-project.org/web/packages/OECD/index.html)) able to extract the datasets, but I will use a local copy: 

```{r}
dent_oecd <- read_csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vStv7Pr69DtRKv6Nw6gVBep8hbT3pEeO6B1vNwxK_1DUHgpoTgbuRpZ4SvgtHFQnBZJVGeeQVyRuXZl/pub?gid=1330297229&single=true&output=csv")
```
Always is preferable to take a look the data and its structure: 

```{r}
head(dent_oecd)
```
```{r}
glimpse(dent_oecd)
```


I will use the `Dentists graduates`, and `Per 100 000 population` so let's filter and replace the former data set

```{r}
dent_oecd <- dent_oecd %>% 
  filter(Variable == "Dentists graduates", 
         Measure == "Per 100 000 population")
```

Let's plot. Since is a temporal trend, a line plot could be a good idea: 
```{r}
dent_oecd %>%  # this means: take the dent_oecd dataframe, and
  ggplot(aes(x = Year, y = Value, color = Country)) + #plot the year in the X axis, the value in the y axis and color the lines per country
  geom_line() + 
  labs(y = "Dentists graduation per 100 000 hab")
```

Hmmm....the problem here is that isn't easy to differentiate the countries. 

We have to choices: 
  - plot each country separate, or
  - highlight one or few countries from the group we can use the package
  
## Plot each country separate
```{r}
dent_oecd  %>% 
    ggplot(aes(x = Year, y = Value)) + # we delete the color = Country, since is not necessary
  geom_line() + 
  facet_wrap(~Country) + #this means: plot separately each country 
  theme(axis.text.x = element_text(colour="grey20",size=6)) + 
  labs(y = "Dentists graduation per 100 000 hab")
  
```

This is great. Here we can see that Chile has increased his dentist workforce significantly more than other OECD countries. 

_TODO: learn how to order the plots _

## Using `gghighlight`
`gghighlight` is a package that highlight ggplot's Lines and Points with Predicates

```{r, echo=FALSE, results='hide'}
library(gghighlight)
```

Now we can fix this mess: 
```{r}
dent_oecd %>%  
  ggplot(aes(x = Year, y = Value, color = Country)) + 
  geom_line() + 
  labs(y = "Dentists graduation per 100 000 hab")
```

First we calculate the mean of dentists per 100 000 hab in OECD countries for the last year: 

```{r}
dent_oecd %>% 
  gghighlight_line(aes(x = Year, y = Value, color = Country), 
                   predicate = max(Value) > 5) + 
  labs(y = "Dentists graduation per 100 000 hab")
```

And a pivot table in the `dplyr` way
```{r}
dent_oecd %>% 
  group_by(Country, Year) %>% 
  summarise(average = mean(Value)) %>% 
  spread(Year, average)
```

Now enhance the table with the package `kableExtra`: 

`install.packages("kableExtra")`

`library(kableExtra)`

```{r, echo=FALSE, results='hide'}
library(kableExtra)
```

```{r}
table_dent <- dent_oecd %>% 
  group_by(Country, Year) %>% 
  summarise(average = mean(Value)) %>% 
  spread(Year, average) 
```

```{r, results='asis'}
knitr::kable(table_dent, 
             caption = "Dentists graduating per 100 000 habs. OECD countries")
```

